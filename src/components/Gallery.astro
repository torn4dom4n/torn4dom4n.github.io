---
import { Image } from "astro:assets";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { Dialog, DialogContent, DialogTrigger } from "@/components/ui/dialog";
import type { ImageMetadata } from "astro";

// Load image modules (promise-based resolvers)
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/gallery/*",
);

// Preload image metadata
const loadedImages = await Promise.all(
  Object.entries(images).map(async ([path, resolver]) => {
    const { default: image } = await resolver();
    return { path, image };
  }),
);

// Helper: create alt text from filename
const getAltFromPath = (path: string) => {
  return path.split("/").pop()?.split(".")[0]?.replace(/[-_]/g, " ") ?? "Image";
};
---

<Card className="p-8 lg:col-span-2 xl:col-span-4">
  <CardHeader>
    <CardTitle
      className="text-xl font-medium tracking-tight text-primary md:text-6xl"
    >
      Gallery
    </CardTitle>
    <CardDescription className="mt-4 text-sm">
      One day, you'll leave this world behind so live a life you will remember.
    </CardDescription>
  </CardHeader>

  <CardContent className="columns-1 gap-4 md:columns-2">
    {
      loadedImages.map(({ path, image }) => (
        <Dialog>
          <DialogTrigger asChild>
            <Image
              class="mt-4 h-auto max-w-full rounded-lg cursor-pointer hover:opacity-80 transition duration-300"
              src={image}
              alt={getAltFromPath(path)}
              loading="lazy"
            />
          </DialogTrigger>
          <DialogContent class="text-white p-0">
            <Image
              class="h-auto max-w-full rounded-lg"
              src={image}
              alt={getAltFromPath(path)}
            />
          </DialogContent>
        </Dialog>
      ))
    }
  </CardContent>
</Card>
